apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gharts.fullname" . }}-config
  labels:
    {{- include "gharts.labels" . | nindent 4 }}
data:
  # GitHub configuration
  GITHUB_ORG: {{ .Values.config.github.organization | quote }}
  GITHUB_APP_ID: {{ .Values.config.github.appId | quote }}
  GITHUB_APP_INSTALLATION_ID: {{ .Values.config.github.installationId | quote }}
  GITHUB_APP_PRIVATE_KEY_PATH: "/secrets/github/private-key.pem"

  # OIDC configuration (all fields required by app, even when disabled)
  ENABLE_OIDC_AUTH: {{ .Values.config.oidc.enabled | quote }}
  OIDC_ISSUER: {{ .Values.config.oidc.issuer | default "https://placeholder.invalid" | quote }}
  OIDC_AUDIENCE: {{ .Values.config.oidc.audience | default "gharts" | quote }}
  OIDC_JWKS_URL: {{ .Values.config.oidc.jwksUrl | default "https://placeholder.invalid/.well-known/jwks.json" | quote }}

  # Bootstrap admin configuration
  {{- if .Values.config.bootstrap.enabled }}
  BOOTSTRAP_ADMIN_USERNAME: {{ .Values.config.bootstrap.username | quote }}
  BOOTSTRAP_ADMIN_EMAIL: {{ .Values.config.bootstrap.email | quote }}
  {{- end }}

  # Admin identities
  {{- if .Values.config.adminIdentities }}
  ADMIN_IDENTITIES: {{ .Values.config.adminIdentities | quote }}
  {{- end }}

  # Sync configuration
  SYNC_ENABLED: {{ .Values.config.sync.enabled | quote }}
  SYNC_INTERVAL_SECONDS: {{ .Values.config.sync.intervalSeconds | quote }}
  SYNC_ON_STARTUP: {{ .Values.config.sync.onStartup | quote }}

  # Logging
  LOG_LEVEL: {{ .Values.config.logLevel | default "INFO" | quote }}

  # Backend API URL for frontend
  VITE_API_URL: "http://{{ include "gharts.fullname" . }}-backend:{{ .Values.backend.service.port }}"

# Made with Bob
