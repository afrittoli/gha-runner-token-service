apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gharts.fullname" . }}-config
  labels:
    {{- include "gharts.labels" . | nindent 4 }}
data:
  # Database configuration
  DATABASE_HOST: {{ include "gharts.database.host" . | quote }}
  DATABASE_PORT: {{ include "gharts.database.port" . | quote }}
  DATABASE_NAME: {{ include "gharts.database.name" . | quote }}
  DATABASE_USERNAME: {{ include "gharts.database.username" . | quote }}
  {{- if not .Values.postgresql.enabled }}
  DATABASE_SSL_MODE: {{ .Values.externalDatabase.sslMode | quote }}
  {{- end }}

  # GitHub configuration
  GITHUB_ORG: {{ .Values.config.github.organization | quote }}
  GITHUB_APP_ID: {{ .Values.config.github.appId | quote }}
  GITHUB_INSTALLATION_ID: {{ .Values.config.github.installationId | quote }}

  # OIDC configuration
  {{- if .Values.config.oidc.enabled }}
  OIDC_ENABLED: "true"
  OIDC_ISSUER: {{ .Values.config.oidc.issuer | quote }}
  OIDC_CLIENT_ID: {{ .Values.config.oidc.clientId | quote }}
  OIDC_REDIRECT_URI: {{ .Values.config.oidc.redirectUri | quote }}
  {{- else }}
  OIDC_ENABLED: "false"
  {{- end }}

  # Bootstrap admin configuration
  {{- if .Values.config.bootstrap.enabled }}
  BOOTSTRAP_ADMIN_USERNAME: {{ .Values.config.bootstrap.username | quote }}
  BOOTSTRAP_ADMIN_EMAIL: {{ .Values.config.bootstrap.email | quote }}
  {{- end }}

  # Admin identities
  {{- if .Values.config.adminIdentities }}
  ADMIN_IDENTITIES: {{ .Values.config.adminIdentities | quote }}
  {{- end }}

  # Sync configuration
  {{- if .Values.config.sync.enabled }}
  SYNC_ENABLED: "true"
  SYNC_INTERVAL_SECONDS: {{ .Values.config.sync.intervalSeconds | quote }}
  SYNC_ON_STARTUP: {{ .Values.config.sync.onStartup | quote }}
  {{- else }}
  SYNC_ENABLED: "false"
  {{- end }}

  # Backend API URL for frontend
  VITE_API_URL: "http://{{ include "gharts.fullname" . }}-backend:{{ .Values.backend.service.port }}"

# Made with Bob
